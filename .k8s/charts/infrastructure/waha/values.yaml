# WAHA (WhatsApp HTTP API) Helm Chart Values
# Configuration for Orange Wallet notification infrastructure

# Basic Configuration
name: waha
namespace: default
replicaCount: 1  # IMPORTANT: Keep at 1 for session persistence

# Docker Image
image:
  repository: devlikeapro/waha
  tag: latest
  pullPolicy: IfNotPresent

# Service Configuration
service:
  type: ClusterIP
  port: 3000

# Secret Configuration
# ⚠️ CHANGE THESE VALUES IN PRODUCTION!
secret:
  name: waha-secret
  apiKey: "your-secret-api-key-change-me"  # Used by notification-worker
  dashboardUsername: "admin"
  dashboardPassword: "change-me-in-production"
  webhookHmacSecret: "your-webhook-hmac-secret-change-me"

# WAHA Configuration
config:
  # Timezone
  timezone: "Asia/Jakarta"

  # WhatsApp Engine (WEBJS or NOWEB)
  # WEBJS: More stable, requires browser
  # NOWEB: Lightweight, no browser needed
  whatsappEngine: "WEBJS"

  # Logging
  logFormat: "JSON"
  logLevel: "info"  # debug, info, warn, error

  # File Management
  filesLifetime: 0  # 0 = keep forever, or specify seconds

  # Webhook Configuration
  # This URL will receive WhatsApp events
  webhookUrl: "http://notification-worker:8080/api/webhooks/waha"
  webhookEvents: "message,message.any,session.status,message.ack"

  # Session Management
  autoStartDelay: 5  # Seconds to wait before auto-starting sessions
  restartAllSessions: true  # Auto-restart sessions on startup
  workerId: "waha-k8s"  # Identifier for this WAHA instance
  printQR: true  # Print QR code to logs for easy scanning

# Persistent Storage Configuration
persistence:
  # Sessions storage (QR codes, auth data)
  sessions:
    enabled: true
    size: 2Gi  # Increase if managing many WhatsApp accounts
    accessMode: ReadWriteOnce
    mountPath: /app/.sessions
    # storageClass: ""  # Leave empty for default, or specify: gcp-pd-standard, local-path, etc.

  # Media storage (sent/received files)
  media:
    enabled: true
    size: 5Gi  # Increase based on media volume
    accessMode: ReadWriteOnce
    mountPath: /app/.media
    # storageClass: ""

# Resource Limits
resources:
  requests:
    memory: "256Mi"
    cpu: "200m"
  limits:
    memory: "512Mi"
    cpu: "500m"

# Health Checks
healthcheck:
  liveness:
    initialDelaySeconds: 40
    periodSeconds: 30
    timeoutSeconds: 10
    failureThreshold: 3
  readiness:
    initialDelaySeconds: 30
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 3

# Notes:
# - WAHA must run as single replica (replicaCount: 1) due to WhatsApp session constraints
# - Each WhatsApp session can only be active on ONE device/instance at a time
# - Persistent volumes are required to maintain sessions across pod restarts
# - Change all secret values before deploying to production!
