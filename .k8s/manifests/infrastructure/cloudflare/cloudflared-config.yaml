---
apiVersion: v1
kind: ConfigMap
metadata:
  name: cloudflared-config
  namespace: orange-wallet
data:
  config.yaml: |
    tunnel: orange-wallet
    credentials-file: /etc/cloudflared/credentials.json
    metrics: 0.0.0.0:2000
    loglevel: info

    # Ingress rules - route traffic to NGINX Ingress Controller
    ingress:
      - hostname: api.orangebybni.my.id
        service: http://nginx-ingress-ingress-nginx-controller.ingress-nginx.svc.cluster.local:80
        originRequest:
          noTLSVerify: true
          connectTimeout: 30s

      # Auth service - direct authentication endpoint
      - hostname: auth.orangebybni.my.id
        service: http://nginx-ingress-ingress-nginx-controller.ingress-nginx.svc.cluster.local:80
        originRequest:
          noTLSVerify: true
          connectTimeout: 30s

      # Catch-all rule (required by Cloudflare)
      - service: http_status:404

    protocol: quic
    retries: 5
    grace-period: 30s