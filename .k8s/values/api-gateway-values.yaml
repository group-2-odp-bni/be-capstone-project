# API Gateway Helm Values
# Entry point for all microservices

replicaCount: 1

image:
  repository: munawaralimy/orange-pay-api-gateway
  tag: latest
  pullPolicy: Always

nameOverride: "api-gateway"
fullnameOverride: "api-gateway"

service:
  type: ClusterIP
  port: 8080
  targetPort: 8080
  annotations: {}

ingress:
  enabled: true
  className: nginx
  annotations:
    nginx.ingress.kubernetes.io/rewrite-target: /
    nginx.ingress.kubernetes.io/ssl-redirect: "false"
    # CORS configuration
    nginx.ingress.kubernetes.io/enable-cors: "true"
    nginx.ingress.kubernetes.io/cors-allow-methods: "GET, POST, PUT, DELETE, PATCH, OPTIONS"
    nginx.ingress.kubernetes.io/cors-allow-origin: "*"
    # Proxy configuration for better performance
    nginx.ingress.kubernetes.io/proxy-body-size: "10m"
    nginx.ingress.kubernetes.io/proxy-connect-timeout: "30"
    nginx.ingress.kubernetes.io/proxy-read-timeout: "30"
    nginx.ingress.kubernetes.io/proxy-send-timeout: "30"
  hosts:
    # Local development domain
    - host: api.orange-wallet.local
      paths:
        - path: /
          pathType: Prefix
    # Production domain (via Cloudflare Tunnel)
    - host: api.orangebybni.my.id
      paths:
        - path: /
          pathType: Prefix
  # TLS is handled by Cloudflare for production domain
  # No need for cert-manager with Cloudflare Tunnel
  tls: []

resources:
  requests:
    memory: "256Mi"
    cpu: "200m"
  limits:
    memory: "512Mi"
    cpu: "500m"

# Health checks
livenessProbe:
  enabled: true
  httpGet:
    path: /actuator/health/liveness
    port: 8080
  initialDelaySeconds: 60
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 3

readinessProbe:
  enabled: true
  httpGet:
    path: /actuator/health/readiness
    port: 8080
  initialDelaySeconds: 30
  periodSeconds: 5
  timeoutSeconds: 3
  failureThreshold: 3

# Environment variables
env:
  - name: SPRING_PROFILES_ACTIVE
    value: "prod"
  - name: SERVER_PORT
    value: "8080"

  # Eureka/Service Discovery (if using)
  # - name: EUREKA_CLIENT_ENABLED
  #   value: "false"

  # Logging
  - name: LOGGING_LEVEL_ROOT
    value: "INFO"
  - name: LOGGING_LEVEL_COM_ORANGEWALLET
    value: "DEBUG"

  # Management endpoints
  - name: MANAGEMENT_ENDPOINTS_WEB_EXPOSURE_INCLUDE
    value: "health,info,metrics,prometheus"
  - name: MANAGEMENT_ENDPOINT_HEALTH_SHOW_DETAILS
    value: "always"

  # Service URLs (will be updated based on your service discovery)
  - name: AUTH_SERVICE_URL
    value: "http://authentication-service:8080"
  - name: USER_SERVICE_URL
    value: "http://user-service:8080"
  - name: WALLET_SERVICE_URL
    value: "http://wallet-service:8080"
  - name: TRANSACTION_SERVICE_URL
    value: "http://transaction-service:8080"

# Autoscaling (optional)
autoscaling:
  enabled: false
  minReplicas: 1
  maxReplicas: 3
  targetCPUUtilizationPercentage: 80
  targetMemoryUtilizationPercentage: 80

# Pod annotations
podAnnotations:
  prometheus.io/scrape: "true"
  prometheus.io/port: "8080"
  prometheus.io/path: "/actuator/prometheus"

# Security context
securityContext:
  runAsNonRoot: true
  runAsUser: 1000
  fsGroup: 1000
  capabilities:
    drop:
      - ALL
  readOnlyRootFilesystem: false

# Node selector (optional - currently empty, will use worker nodes)
nodeSelector: {}

# Tolerations (optional)
tolerations: []

# Affinity rules (optional)
affinity: {}

# Labels
labels:
  tier: gateway
  component: api
