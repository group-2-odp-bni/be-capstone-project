# Authentication Service Helm Values
# Handles user authentication and JWT token management

replicaCount: 1

image:
  repository: munawaralimy/orange-pay-authentication-service
  tag: latest
  pullPolicy: Always

nameOverride: "authentication-service"
fullnameOverride: "authentication-service"

service:
  type: ClusterIP
  port: 8080
  targetPort: 8080
  annotations: {}

ingress:
  enabled: true
  className: nginx
  annotations:
    nginx.ingress.kubernetes.io/rewrite-target: /
    nginx.ingress.kubernetes.io/ssl-redirect: "false"
    # CORS configuration
    nginx.ingress.kubernetes.io/enable-cors: "true"
    nginx.ingress.kubernetes.io/cors-allow-methods: "GET, POST, PUT, DELETE, PATCH, OPTIONS"
    nginx.ingress.kubernetes.io/cors-allow-origin: "*"
    # Proxy configuration
    nginx.ingress.kubernetes.io/proxy-body-size: "5m"
    nginx.ingress.kubernetes.io/proxy-connect-timeout: "30"
    nginx.ingress.kubernetes.io/proxy-read-timeout: "30"
  hosts:
    # Local development domain
    - host: auth.orange-wallet.local
      paths:
        - path: /
          pathType: Prefix
    # Production domain (via Cloudflare Tunnel)
    - host: auth.orangebybni.my.id
      paths:
        - path: /
          pathType: Prefix
  # TLS is handled by Cloudflare
  tls: []

resources:
  requests:
    memory: "256Mi"
    cpu: "200m"
  limits:
    memory: "512Mi"
    cpu: "500m"

# Health checks
livenessProbe:
  enabled: true
  httpGet:
    path: /actuator/health/liveness
    port: 8080
  initialDelaySeconds: 60
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 3

readinessProbe:
  enabled: true
  httpGet:
    path: /actuator/health/readiness
    port: 8080
  initialDelaySeconds: 30
  periodSeconds: 5
  timeoutSeconds: 3
  failureThreshold: 3

# Environment variables
env:
  SPRING_PROFILES_ACTIVE: "prod"
  SERVER_PORT: "8080"

  # Database configuration
  SPRING_DATASOURCE_URL: "jdbc:postgresql://postgres:5432/orangewallet"
  SPRING_DATASOURCE_USERNAME:
    valueFrom:
      secretKeyRef:
        name: postgres-secret
        key: username
  SPRING_DATASOURCE_PASSWORD:
    valueFrom:
      secretKeyRef:
        name: postgres-secret
        key: password

  # Redis configuration
  SPRING_DATA_REDIS_HOST: "redis"
  SPRING_DATA_REDIS_PORT: "6379"

  # JWT configuration
  JWT_SECRET_KEY:
    valueFrom:
      secretKeyRef:
        name: app-secrets
        key: jwt-secret-key

  # Logging
  LOGGING_LEVEL_ROOT: "INFO"
  LOGGING_LEVEL_COM_ORANGEWALLET: "DEBUG"

  # Management endpoints
  MANAGEMENT_ENDPOINTS_WEB_EXPOSURE_INCLUDE: "health,info,metrics,prometheus"
  MANAGEMENT_ENDPOINT_HEALTH_SHOW_DETAILS: "always"

# Autoscaling
autoscaling:
  enabled: false
  minReplicas: 1
  maxReplicas: 3
  targetCPUUtilizationPercentage: 80

# Pod annotations
podAnnotations:
  prometheus.io/scrape: "true"
  prometheus.io/port: "8080"
  prometheus.io/path: "/actuator/prometheus"

# Security context
securityContext:
  runAsNonRoot: true
  runAsUser: 1000
  fsGroup: 1000
  capabilities:
    drop:
      - ALL
  readOnlyRootFilesystem: false

# Node selector
nodeSelector: {}

# Tolerations
tolerations: []

# Affinity rules
affinity: {}

# Labels
labels:
  tier: backend
  component: authentication
