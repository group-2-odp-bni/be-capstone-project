replicaCount: 1

image:
  registry: docker.io
  repository: teukumunawar/orange-pay-user-service
  tag: latest
  pullPolicy: Always

nameOverride: "user-service"
fullnameOverride: "user-service"

service:
  type: ClusterIP
  annotations: {}

resources:
  requests:
    memory: "192Mi"
    cpu: "150m"
  limits:
    memory: "512Mi"
    cpu: "500m"

# Health checks
livenessProbe:
  enabled: true
  httpGet:
    path: /actuator/health/liveness
    port: 8080
  initialDelaySeconds: 60
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 3

readinessProbe:
  enabled: true
  httpGet:
    path: /actuator/health/readiness
    port: 8080
  initialDelaySeconds: 30
  periodSeconds: 5
  timeoutSeconds: 3
  failureThreshold: 3

startupProbe:
  enabled: true
  httpGet:
    path: /actuator/health
    port: 8080
  initialDelaySeconds: 0
  periodSeconds: 10
  timeoutSeconds: 3
  failureThreshold: 30

# Environment variables
env:
  SPRING_PROFILES_ACTIVE: "prod"
  SERVER_PORT: "8080"

  # Database configuration
  DB_URL: "jdbc:postgresql://postgres:5432/orange_db"

  # Redis configuration
  SPRING_DATA_REDIS_HOST: "redis"
  SPRING_DATA_REDIS_PORT: "6379"

  # JWT configuration
  SPRING_SECURITY_OAUTH2_RESOURCESERVER_JWT_JWK_SET_URI: "http://authentication-service:8080/oauth2/jwks"

  # Kafka configuration (Spring Boot defaults)
  SPRING_KAFKA_BOOTSTRAP_SERVERS: "kafka:9092"
  SPRING_KAFKA_CONSUMER_GROUP_ID: "user-service"
  SPRING_KAFKA_CONSUMER_AUTO_OFFSET_RESET: "earliest"
  SPRING_KAFKA_CONSUMER_ENABLE_AUTO_COMMIT: "false"

  # Custom Kafka producer config
  ORANGE_KAFKA_PRODUCER_BOOTSTRAP_SERVERS: "kafka:9092"
  ORANGE_KAFKA_PRODUCER_KEY_SERIALIZER: "org.apache.kafka.common.serialization.StringSerializer"
  ORANGE_KAFKA_PRODUCER_VALUE_SERIALIZER: "org.apache.kafka.common.serialization.ByteArraySerializer"
  ORANGE_KAFKA_PRODUCER_ACKS: "all"
  ORANGE_KAFKA_PRODUCER_RETRIES: "3"
  ORANGE_KAFKA_PRODUCER_BACKOFF: "1s"
  ORANGE_KAFKA_PRODUCER_IDEMPOTENCE: "true"
  ORANGE_KAFKA_PRODUCER_COMPRESSION_TYPE: "snappy"
  ORANGE_KAFKA_PRODUCER_RELIABILITY_MAX_IN_FLIGHT_REQUESTS_PER_CONNECTION: "5"
  ORANGE_KAFKA_PRODUCER_RELIABILITY_REQUEST_TIMEOUT: "30s"
  ORANGE_KAFKA_PRODUCER_RELIABILITY_DELIVERY_TIMEOUT: "2m"
  ORANGE_KAFKA_PRODUCER_BATCHING_LINGER_MS: "20"
  ORANGE_KAFKA_PRODUCER_BATCHING_BATCH_SIZE: "32768"

  # Logging
  LOGGING_LEVEL_ROOT: "INFO"

  # Management endpoints
  MANAGEMENT_ENDPOINTS_WEB_EXPOSURE_INCLUDE: "health,info,metrics,prometheus"
  MANAGEMENT_ENDPOINT_HEALTH_SHOW_DETAILS: "always"

# Metrics
metrics:
  enabled: false

# Autoscaling
autoscaling:
  enabled: false
  minReplicas: 1
  maxReplicas: 3
  targetCPUUtilizationPercentage: 80

# Pod annotations
podAnnotations:
  prometheus.io/scrape: "true"
  prometheus.io/port: "8080"
  prometheus.io/path: "/actuator/prometheus"

# Labels
labels:
  tier: backend
  component: user-management
